<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Lock over a migration state storage."><meta name="keywords" content="rust, rustlang, rust-lang, StateLock"><title>StateLock in migrate_state - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../migrate_state/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Trait StateLock</h2><div class="sidebar-elems"><div class="block items"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><div class="sidebar-links"><a href="#tymethod.lock">lock</a></div><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div><h2 class="location">Other items in<br><a href="index.html">migrate_state</a></h2><div id="sidebar-vars" data-name="StateLock" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Trait <a href="index.html">migrate_state</a>::<wbr><a class="trait" href="#">StateLock</a><button id="copy-path" onclick="copy_path(this)" title="copy path"><img src="../clipboard.svg" width="19" height="18" alt="Copy item import" title="Copy item import to clipboard"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/migrate_state/lib.rs.html#68-100" title="goto source code">[src]</a></span></h1><div class="docblock type-decl"><pre class="rust trait">pub trait StateLock {
    #[must_use]
    fn <a href="#tymethod.lock" class="fnname">lock</a>&lt;'async_trait&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self: <a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.bool.html">bool</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.54.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.54.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="type" href="type.Result.html" title="type migrate_state::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="trait.StateGuard.html" title="trait migrate_state::StateGuard">StateGuard</a>&gt;&gt;&gt; + <a class="trait" href="https://doc.rust-lang.org/1.54.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt;<br>&nbsp;&nbsp;&nbsp; <span class="where">where<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Self: 'async_trait</span>;
}</pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Lock over a migration state storage.</p>
<p>It guards underlying migration state preventing concurrent access
from multiple threads and processes. Ideally, this should be a distributed
lock implementation.</p>
<p>The main method of this trait is <a href="trait.StateLock.html#tymethod.lock" title="StateLock::lock()"><code>StateLock::lock()</code></a>, see its docs for more
details.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.lock" class="method has-srclink"><h4 class="code-header"><div class="code-attribute">#[must_use]</div>fn <a href="#tymethod.lock" class="fnname">lock</a>&lt;'async_trait&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;self: <a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;force: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.bool.html">bool</a><br>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.54.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.54.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="type" href="type.Result.html" title="type migrate_state::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="trait.StateGuard.html" title="trait migrate_state::StateGuard">StateGuard</a>&gt;&gt;&gt; + <a class="trait" href="https://doc.rust-lang.org/1.54.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;Self: 'async_trait,&nbsp;</span></h4><a class="srclink" href="../src/migrate_state/lib.rs.html#99" title="goto source code">[src]</a></div></summary><div class="docblock"><h1 id="general-concept" class="section-header"><a href="#general-concept">General concept</a></h1>
<p>Acquires exclusive lock to migration state.</p>
<p>Acquiring exclusive lock means that no other subjects
(threads, current and other remote compute instance’s processes)
can access the state. Future returned by this method should
be resolved only after the lock is unlocked (via <a href="trait.StateGuard.html#tymethod.unlock" title="StateGuard::unlock()"><code>StateGuard::unlock()</code></a>)
if it is currently locked, or resolve right away if no other subject is
holding the lock.</p>
<p>This means that if some other subject is already holding a lock,
we should wait for it to unlock it (by awaiting returned future to resolve).</p>
<p>The lock has to be held until a call to <a href="trait.StateGuard.html#tymethod.unlock" title="StateGuard::unlock()"><code>StateGuard::unlock()</code></a> on
returned <a href="trait.StateGuard.html" title="StateGuard"><code>StateGuard</code></a> implementation.</p>
<p>Described behavior is expected when the <code>force</code> parameter is <a href="https://doc.rust-lang.org/1.54.0/std/primitive.bool.html" title="false"><code>false</code></a></p>
<h1 id="boolean-force-parameter" class="section-header"><a href="#boolean-force-parameter">Boolean <code>force</code> parameter</a></h1>
<p>When the <code>force</code> boolean parameter is set to <a href="https://doc.rust-lang.org/1.54.0/std/primitive.bool.html" title="true"><code>true</code></a>, method must
acquire exclusive lock even if it currently acquired by some other subject
and provide the access to underlying state storage regardless.</p>
<p>This operation is dangerous, because it bypasses locking mechanism
which may lead to concurrent state storage mutations.
It exists to help circumvent situations where some subject has
died without unlocking the lock, thus leaving it locked potentially
forver.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"></div><script type="text/javascript" src="../implementors/migrate_state/trait.StateLock.js" async></script></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="migrate_state" data-search-index-js="../search-index.js" data-search-js="../search.js"></div><script src="../main.js"></script></body></html>